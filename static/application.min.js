var haste=function(){this.appName="Hastebin Plus",this.$textarea=$("textarea"),this.$box=$("#code"),this.$code=$("#code code"),this.configureShortcuts(),this.configureButtons()};haste.prototype.setTitle=function(t){var e=t?this.appName+" - "+t:this.appName;document.title=e},haste.prototype.lightKey=function(){this.configureKey(["new","save"])},haste.prototype.fullKey=function(){this.configureKey(["new","duplicate","raw"])},haste.prototype.configureKey=function(t){$("#tools .function").each(function(){for(var e=$(this),o=0;o<t.length;o++)if(e.hasClass(t[o]))return e.addClass("enabled"),!0;e.removeClass("enabled")})},haste.prototype.newDocument=function(t){this.$box.hide(),this.doc=new haste_document,t||window.history.pushState(null,this.appName,"/"),this.setTitle(),this.lightKey(),this.$textarea.val("").show("fast",function(){this.focus()})},haste.prototype.loadDocument=function(t){var e=this;e.doc=new haste_document,e.doc.load(t,function(t){t?(e.$code.html(t.value),e.setTitle(t.key),window.history.pushState(null,e.appName+"-"+t.key,"/"+t.key),e.fullKey(),e.$textarea.val("").hide(),e.$box.show()):e.newDocument()})},haste.prototype.duplicateDocument=function(){if(this.doc.locked){var t=this.doc.data;this.newDocument(),this.$textarea.val(t)}},haste.prototype.lockDocument=function(){var t=this;this.doc.save(this.$textarea.val(),function(e,o){!e&&o&&(t.$code.html(o.value.trim().replace(/.+/g,'<span class="line">$&</span>').replace(/^\s*[\r\n]/gm,'<span class="line"></span>\n')),t.setTitle(o.key),window.history.pushState(null,t.appName+"-"+o.key,"/"+o.key),t.fullKey(),t.$textarea.val("").hide(),t.$box.show())})},haste.prototype.configureButtons=function(){var t=this;this.buttons=[{$where:$("#tools .save"),shortcut:function(t){return t.ctrlKey&&83===t.keyCode},action:function(){""!==t.$textarea.val().replace(/^\s+|\s+$/g,"")&&t.lockDocument()}},{$where:$("#tools .new"),shortcut:function(t){return t.ctrlKey&&32===t.keyCode},action:function(){t.newDocument(!t.doc.key)}},{$where:$("#tools .duplicate"),shortcut:function(e){return t.doc.locked&&e.ctrlKey&&68===e.keyCode},action:function(){t.duplicateDocument()}},{$where:$("#tools .raw"),shortcut:function(t){return t.ctrlKey&&t.shiftKey&&82===t.keyCode},action:function(){window.location.href="/raw/"+t.doc.key}}];for(var e=0;e<this.buttons.length;e++)this.configureButton(this.buttons[e])},haste.prototype.configureButton=function(t){t.$where.click(function(e){e.preventDefault(),!t.clickDisabled&&$(this).hasClass("enabled")&&t.action()})},haste.prototype.configureShortcuts=function(){var t=this;$(document.body).keydown(function(e){for(var o,n=0;n<t.buttons.length;n++)if(o=t.buttons[n],o.shortcut&&o.shortcut(e))return e.preventDefault(),void o.action()})};var haste_document=function(){this.locked=!1};haste_document.prototype.htmlEscape=function(t){return t.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},haste_document.prototype.load=function(t,e){var o=this;$.ajax("/documents/"+t,{type:"get",dataType:"json",success:function(n){o.locked=!0,o.key=t,o.data=n.data,high=hljs.highlightAuto(n.data).value,e({value:high.replace(/.+/g,'<span class="line">$&</span>').replace(/^\s*[\r\n]/gm,'<span class="line"></span>\n'),key:t})},error:function(t){e(!1)}})},haste_document.prototype.save=function(t,e){if(this.locked)return!1;this.data=t;$.ajax("/documents",{type:"post",data:t.trim(),dataType:"json",contentType:"application/json; charset=utf-8",success:function(t){(new haste).loadDocument(t.key)},error:function(t){try{e($.parseJSON(t.responseText))}catch(t){e({message:"Something went wrong!"})}}})},$(function(){$("textarea").keydown(function(t){if(9===t.keyCode){t.preventDefault();var e="    ";if(document.selection)this.focus(),sel=document.selection.createRange(),sel.text=e,this.focus();else if(this.selectionStart||"0"==this.selectionStart){var o=this.selectionStart,n=this.selectionEnd,s=this.scrollTop;this.value=this.value.substring(0,o)+e+this.value.substring(n,this.value.length),this.focus(),this.selectionStart=o+e.length,this.selectionEnd=o+e.length,this.scrollTop=s}else this.value+=e,this.focus()}});var t=new haste,e=window.location.pathname;"/"===e?t.newDocument(!0):t.loadDocument(e.substring(1,e.length))}),hljs.initHighlightingOnLoad();